/*
 * jQuery flowGallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowGallery
 * version 0.6.4 (03-JUL-2011)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(d){d.fn.flowGallery=function(q){m=d.extend(d.fn.flowGallery.defaults,q);return this.each(function(r){b(this)})};d.fn.flowGallery.defaults={activeIndex:0,animate:true,enableKeyNavigation:true,forwardOnActiveClick:false,forceWidth:false,forceHeight:false,backgroundColor:"black",thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900};var m={};var b=function(r){_elCounter=0;_activeIndex=0;_activeElem=false;_activeLoaded=false;_listElem=false;_listWidth=0;_listHeight=0;_centerX=0;_centerY=0;_container=null;_imgData=[];_listElem=r;_container=d(_listElem).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent();var u=document.createElement("div");var t=document.createElement("p");d(t).addClass("bf-caption").css({backgroundColor:m.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(m.imagePadding+10)+"px 15px",position:"absolute"});d(u).addClass("bf-wrapper").css({position:"relative"}).append(_listElem).append(t);_container.append(u);d(window).resize(function(){_listWidth=_container.width();_centerX=_listWidth*0.5;g();p(_activeElem)});var s=d(_listElem).children();var q=false;s.each(function(x){var w=d(this).find("img");if(m.forceWidth){w.width(m.forceWidth)}var v=n(w.get(0));var y=h(w,v);_imgData.push(y);a(w,x);if(x===_activeIndex&&v){q=y.h}c(this,x)});_listWidth=_container.width();_centerX=_listWidth*0.5;if(q){_centerY=m.thumbTopOffset==="auto"?q*0.5:m.thumbTopOffset}else{_centerY=m.thumbTopOffset==="auto"?_listHeight*0.5:m.thumbTopOffset+m.thumbHeight*0.5}if(m.enableKeyNavigation===true){d(document).unbind("keydown",o).keydown(o)}g()};var o=function(q){if(q.keyCode===37){j(-1)}else{if(q.keyCode===39){j(1)}}};var c=function(r,q){d(r).css({backgroundColor:m.backgroundColor,position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"});if(!_activeElem&&m.activeIndex===q){d(r).addClass("active");_activeElem=r;_activeIndex=q}_elCounter++};var g=function(s){var u=true;var r,v,z,w,y=0;var x=null;var q=function(){p(_activeElem);if(_container.width()!==_listWidth){_listWidth=_container.width();_centerX=_listWidth*0.5;g();p(_activeElem)}};var t={};d(_listElem).children().each(function(A){if(d(this).hasClass("active")){t={left:(_centerX-m.imagePadding-_imgData[A].w*0.5)+"px",top:"0",width:_imgData[A].w+"px",height:_imgData[A].h+"px",padding:m.imagePadding+"px"};u=false;x=q}else{t={left:e(A,u),top:(_centerY-_imgData[A].th*0.5)+"px",width:_imgData[A].tw+"px",height:_imgData[A].th+"px",padding:m.thumbPadding+"px"};x=null}if(s){d(this).stop().animate(t,{duration:m.duration,easing:m.easing,complete:x})}else{d(this).css(t);if(x){x()}}})};var e=function(s,q){var r=_centerX;if(q){r-=_imgData[_activeIndex].w*0.5;r-=m.imagePadding;r-=(_activeIndex-s)*10;r-=(_activeIndex-s)*2*m.thumbPadding;for(i=s;i<_activeIndex;i++){r-=_imgData[i].tw}return r+"px"}else{r+=_imgData[_activeIndex].w*0.5;r+=m.imagePadding;r+=(s-_activeIndex)*10;r+=(s-_activeIndex)*2*m.thumbPadding;for(i=_activeIndex+1;i<s;i++){r+=_imgData[i].tw}return r+"px"}};var p=function(t){var s=d(t).find("img").get(0);if(!n(s)){return false}var r=d(t).parent().parent().find("p.bf-caption");var u=s.title;if(s.title.length>0){r.text(u);r.css({left:_centerX-m.imagePadding-_imgData[_activeIndex].w*0.5,top:_imgData[_activeIndex].h+m.imagePadding*2,width:_imgData[_activeIndex].w-20});var q=d(_listElem).height()+r.height()+40;d(_listElem).parent().height(q);r.fadeIn("fast")}};var h=function(t,r){r=r||false;var s,q,v,x=0;if(r){var w=t.get(0);if(typeof w.naturalWidth!=="undefined"){s=m.forceWidth||w.naturalWidth||w.width;q=m.forceHeight||w.naturalHeight||w.height}else{var u=new Image();u.src=t.attr("src");s=u.width;q=u.height}}else{s=t.attr("width");q=t.attr("height")}if(m.thumbWidth==="auto"&&m.thumbHeight=="auto"){v=100;x=Math.round(q*100/s)}else{if(m.thumbHeight==="auto"){v=m.thumbWidth;x=Math.round(q*Number(m.thumbWidth)/s)}else{if(m.thumbWidth==="auto"){v=Math.round(s*Number(m.thumbHeight)/q);x=m.thumbHeight}else{v=m.thumbWidth;x=m.thumbHeight}}}l(q);return{h:q,w:s,th:x,tw:v}};var n=function(q){if((m.forceWidth&&m.forceHeight)||(q.width>m.thumbWidth&&q.height>20)){return true}if(!q.complete){return false}if(typeof q.naturalWidth!=="undefined"&&q.naturalWidth===0){return false}return true};var a=function(q,r){q.hide().parent().addClass(m.loadingClass).css({height:_imgData[r].th,width:_imgData[r].tw});var s=function(v){if(this.complete||(this.readyState==="complete"&&v.type==="readystatechange")){d(this).css("visibility","visible").parent().removeClass(m.loadingClass);d(this).fadeIn();var u=h(q,true);_imgData[r]=u;if(r===m.activeIndex){_activeLoaded=true;_centerY=m.thumbTopOffset==="auto"?u.h*0.5:m.thumbTopOffset;if(v){g()}}else{var w={height:u.th};if(_activeLoaded){w.top=(_centerY-_imgData[r].th*0.5)+"px"}q.parent().animate(w)}k(q.parent())}};var t=q.get(0);if(t.complete){s.call(t)}else{q.bind("load readystatechange",s).bind("error",function(){d(this).css("visibility","visible").parent().removeClass(m.loadingClass)})}};var k=function(q){d(q).click(function(){if(this!==_activeElem){d("p.bf-caption").hide();_activeIndex=0;_activeElem=this;d(this).parent().children().each(function(r){if(_activeElem===this){_activeIndex=r}});f();g(m.animate)}else{if(m.forwardOnActiveClick===true){j(1)}}})};var j=function(q){if(q<0&&_activeIndex>0){_activeIndex+=q}else{if(q>0&&_activeIndex<_imgData.length-1){_activeIndex+=q}else{return false}}_activeElem=d(_listElem).children().get(_activeIndex);f();g(m.animate)};var f=function(q){d("p.bf-caption").hide();d(_listElem).find(".active").removeClass("active");d(_activeElem).addClass("active");_listWidth=_container.width();_centerX=_listWidth*0.5};var l=function(q){if(q>_listHeight){_listHeight=q;_listHeight+=m.imagePadding*2;d(_listElem).height(_listHeight)}}})(jQuery);